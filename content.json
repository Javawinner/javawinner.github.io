{"meta":{"title":"Hexo","subtitle":null,"description":null,"author":"John Doe","url":"http://yoursite.com","root":"/"},"pages":[],"posts":[{"title":"Hello World","slug":"hello-world","date":"2019-07-14T10:59:23.728Z","updated":"2019-07-14T10:59:23.728Z","comments":true,"path":"2019/07/14/hello-world/","link":"","permalink":"http://yoursite.com/2019/07/14/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]},{"title":"模拟一个简单的web请求","slug":"模拟一个简单的web请求","date":"2019-07-08T14:42:06.275Z","updated":"2019-07-14T13:09:37.482Z","comments":true,"path":"2019/07/08/模拟一个简单的web请求/","link":"","permalink":"http://yoursite.com/2019/07/08/模拟一个简单的web请求/","excerpt":"","text":"引子描述下当我们在浏览器输入一个url网址，比如说www,jd.com, 然后显示整个页面的过程1231. 当输入http://www.jd.com的时候，先把请求发送到本地DNS服务器里找www.jd.com对应的Ip地址和端口，如果有，返回ip地址和端口，2. 如果本地DNS服务器里面没有字符串 www.jd.com对应的ip地址和端口，则会去DNS根域服务器去找（root-server.net）,根域会把字符串交给顶级域服务器.com DNS服务器，然后会 将字符串交个权威DNS服务器找到jd.com,然后再去二级域名服务器找到www.jd.com3. 当客户端(浏览器)获得了ip地址和端口，客户端发送请求到响应的服务器，服务器响应需求，客户端拿到响应结果，渲染页面。 字符串和字节的转换12345678910\\&gt;&gt;&gt; s=\"hello\"\\&gt;&gt;&gt; s'hello'\\&gt;&gt;&gt; bytes(s,encoding=\"utf-8\")b'hello'\\&gt;&gt;&gt; b=bytes(s,encoding=\"utf-8\")\\&gt;&gt;&gt; bb'hello'\\&gt;&gt;&gt; str(b,encoding='utf-8')'hello' 模拟一个简单的web请求1234567891011121314151617181920212223242526272829303132333435363738394041from socket import *sock = socket(AF_INET, SOCK_STREAM)sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)sock.bind(('127.0.0.1', 8800))sock.listen(5)while True: # 不断地等待接收客户端的链接,保证服务器不中断 print('\\033[32mserver waiting...\\033[0m') client, addr = sock.accept() # 客户端套接字对象，客户端地址端口 data = client.recv(1024) print('data', data) # client.send(b'hello world') # 浏览器端会显示 127.0.0.1 发送的响应无效 # 浏览器要访问数据必须加上HTTP/1.1 状态码 # HTTP/1.1 200 OK 响应首行 hello world 响应体 响应首行和响应体之前用\\r\\n\\r\\n，否则响应体无法渲染显示 with open('index.html','rb') as f: data=f.read() client.send(b'HTTP/1.1 200 OK\\r\\n\\r\\n%s'%data) client.close() # index.html &lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1 style=\"color: red;\"&gt;宝贝 我来了&lt;/h1&gt;&lt;img src=\"http://s14.sinaimg.cn/middle/4b955cd7xcb1739815c4d&amp;690\" alt=\"\"&gt;&lt;a href=\"http://www.w3school.com.cn/\"&gt;click&lt;/a&gt;&lt;div style=\"height: 200px\"&gt;&lt;/div&gt;&lt;div&gt; &lt;h1 style=\"color: yellow; background-color: gray\"&gt;张帆喜欢的类型&lt;/h1&gt; &lt;img src=\"http://s8.sinaimg.cn/bmiddle/005DIuBKgy6KewCX5iv97&amp;690\" alt=\"\"&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 123456/usr/local/bin/python3.6 /Users/cjw/Desktop/pycharm_project/Django/Weby应用程序/JDserver.pyserver waiting...data b'GET / HTTP/1.1\\r\\nHost: 127.0.0.1:8800\\r\\nConnection: keep-alive\\r\\nCache-Control: max-age=0\\r\\nUpgrade-Insecure-Requests: 1\\r\\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36\\r\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3\\r\\nAccept-Encoding: gzip, deflate, br\\r\\nAccept-Language: zh-CN,zh;q=0.9\\r\\n\\r\\n'server waiting...data b'GET /favicon.ico HTTP/1.1\\r\\nHost: 127.0.0.1:8800\\r\\nConnection: keep-alive\\r\\nPragma: no-cache\\r\\nCache-Control: no-cache\\r\\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36\\r\\nAccept: image/webp,image/apng,image/*,*/*;q=0.8\\r\\nReferer: http://127.0.0.1:8800/\\r\\nAccept-Encoding: gzip, deflate, br\\r\\nAccept-Language: zh-CN,zh;q=0.9\\r\\n\\r\\n'server waiting... 浏览器会解释url请求发生了什么1234response: 从客户端接收过来的一堆HTML字符串(要放到页面的一堆字符串)Preview: 浏览器解析服务端发送的的HTML字符串，将这些字符串解析成用户能看到的格式，preview能够看到一个这样的结果所以浏览器也可以看成一个解释期，解释HTML标记语言 HTTP协议主要由请求协议和响应协议构成 请求协议：浏览器给服务器发的格式的限定 响应协议：服务器给浏览器发的格式的限定 HTTP请求协议12345678结构：请求首行+请求头+\\r\\n\\r\\n+请求体服务器通过\\r\\n来识别请求首行，请求头以及请求体请求首行和请求头之间，多个请求体之间用一个\\r\\n分割，最后一个请求头和请求体之间用两个\\r\\n分割请求方法主要分get和postget 没有请求体 post 有请求体 get 和 post请求1231. GET请求提交的数据会放在url之后，以？分割URL和传输的数据，参数之间用&amp;相连，比如http://127.0.0.1:8800/?name=changwei&amp;pwd=GET2. GET 提交的数据大小有限制(因为浏览器对URL长度有限制)，而POST方法提交的数据没有限制3. GET与POST都是提交数据的方式，当需要对服务器所在的数据库的数据进行查询的时候提交GET请求，添加或删除提交POST请求 案例1 （get请求）1'GET / HTTP/1.1\\r\\nHost: 127.0.0.1:8800\\r\\nConnection: keep-alive\\r\\nCache-Control: max-age=0\\r\\nUpgrade-Insecure-Requests: 1\\r\\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36\\r\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3\\r\\nAccept-Encoding: gzip, deflate, br\\r\\nAccept-Language: zh-CN,zh;q=0.9\\r\\n\\r\\n' 请求首行12GET / HTTP/1.1\\r\\nHost: 127.0.0.1:8800格式： 方法(get/post)+发送请求的服务器的路径（URI /form/entry)+协议版本(HTTP/1.1) 请求头1234567请求头 Connection: keep-alive请求头 Pragma: no-cache请求头 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36请求头 Accept: image/webp,image/apng,image/*,*/*;q=0.8请求头 Referer: http://127.0.0.1:8800请求头 Accept-Encoding: gzip, deflate, br请求头 Accept-Language: zh-CN,zh;q=0.9 请求体12341. get请求没有请求体 所以最后的请求体部分是空的2. get请求提交的数据会放在url之后，以？分割URL和传输的数据，参数之间用&amp;相连，比如http://127.0.0.1:8800/?name=changwei&amp;pwd=123'GET /?name=changwei&amp;pwd=123 HTTP/1.1\\r\\nHost: 127.0.0.1:8800\\r\\nConnection: keep-alive\\r\\nUpgrade-Insecure-Requests: 1\\r\\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36\\r\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3\\r\\nAccept-Encoding: gzip, deflate, br\\r\\nAccept-Language: zh-CN,zh;q=0.9\\r\\n\\r\\n' 案例2 （post请求）12345678910111213141516171819202122232425262728293031323334353637# 服务端from socket import *sock = socket(AF_INET, SOCK_STREAM)sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)sock.bind(('127.0.0.1', 8800))sock.listen(5)while True: # 不断地等待接收客户端的链接,保证服务器不中断 print('\\033[32mserver waiting...\\033[0m') client, addr = sock.accept() # 客户端套接字对象，客户端地址端口 data = client.recv(1024) print('data', data) # client.send(b'hello world') # 浏览器端会显示 127.0.0.1 发送的响应无效 # 浏览器要访问数据必须加上HTTP/1.1 状态码 # HTTP/1.1 200 OK 响应首行 hello world 响应体 响应首行和响应体之前用\\r\\n\\r\\n，否则响应体无法渲染显示 with open('login.html','rb') as f: data=f.read() client.send(b'HTTP/1.1 200 OK\\r\\n\\r\\n%s'%data) client.close()# index.html&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=\"http://127.0.0.1:8800/\" method=\"post\"&gt; 用户名 &lt;input type=\"text\" name=\"user\"&gt; 密码 &lt;input type=\"password\" name=\"pwd\"&gt; &lt;input type=\"submit\"&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; 1'POST / HTTP/1.1\\r\\nHost: 127.0.0.1:8800\\r\\nConnection: keep-alive\\r\\nContent-Length: 21\\r\\nCache-Control: max-age=0\\r\\nOrigin: http://127.0.0.1:8800\\r\\nUpgrade-Insecure-Requests: 1\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36\\r\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3\\r\\nReferer: http://127.0.0.1:8800/\\r\\nAccept-Encoding: gzip, deflate, br\\r\\nAccept-Language: zh-CN,zh;q=0.9\\r\\n\\r\\nuser=changwei&amp;pwd=123' 请求首行12345678POST / HTTP/1.1\\r\\nHost: 127.0.0.1:8800Cache-Control: max-age=0\\r\\nOrigin: http://127.0.0.1:8800Upgrade-Insecure-Requests: 1Content-Type: application/x-www-form-urlencodedUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3Referer: http://127.0.0.1:8800/\\r\\nAccept-Encoding: gzip, deflate, brAccept-Language: zh-CN,zh;q=0.9 请求头1Connection: keep-alive\\r\\nContent-Length: 21 请求体1user=changwei&amp;pwd=123 HTTP响应协议和请求协议一样，主要由响应首行，响应头，响应体组成 常见的响应状态码123451xx Informational(信息性状态码) 接受的请求正在处理2xx Success(成功状态码) 请求正常处理完毕3xx Redirection(重定向状态码) 需要进行附加操作以完成请求 (域名地址变了了,跳转到新的域名地址，这种情况浏览器发2次请求)4xx Client Error (客户端错误状态码) 服务器无法处理请求 404 (not found) 403(forbidden 禁止访问) 5xx Server Error(服务器错误状态码) 服务器处理请求出错 500(服务端代码错误) 502(网关错误 bad gateway) 通过socket实现web框架server.py123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102import timefrom socket import *def f1(): # 静态网站 fp = open('index.html', 'r', encoding='utf-8') data = fp.read() fp.close() return bytes(data, encoding='utf-8')def f2(): fp = open('article.html', 'r', encoding='utf-8') data = fp.read() ctime = time.time() data = data.replace(\"@@content@@\", str(ctime)) fp.close() return bytes(data, encoding='utf-8')def f3(): import pymysql conn = pymysql.connect(host='127.0.0.1', user='root', password='123', db='youku', charset='utf8') cursor = conn.cursor(cursor=pymysql.cursors.DictCursor) sql = \"select id,name,password,register_time from user\" cursor.execute(sql) res = cursor.fetchall() print(res) ''' [&#123;'id': 1, 'name': 'lxx', 'password': '202cb962ac59075b964b07152d234b70', 'register_time': '2019-06-26 21:48:47'&#125;, &#123;'id': 2, 'name': '111', 'password': '698d51a19d8a121ce581499d7b701668', 'register_time': '2019-06-26 21:49:10'&#125;] ''' res_list = [] for user in res: res_str = '&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % ( user['id'], user['name'], user['password'], user['register_time']) res_list.append(res_str) s = ''.join(res_list) fp = open('content.html', 'r', encoding='utf-8') data = fp.read() data = data.replace(\"@@content@@\", s) return bytes(data, encoding='utf-8') ### 需要将html代码和mysql结果融合def f4(): pass# 路由系统routes = [ ('/xxx', f1), ('/ooo', f2), ('/hhh', f3), ('/kkk', f4)]def run(): sk = socket() sk.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1) sk.bind(('127.0.0.1', 8081)) sk.listen(5) while True: conn, addr = sk.accept() buf = conn.recv(8096) data = str(buf, encoding='utf-8') header_list = data.split('\\r\\n\\r\\n')[0].split('\\r\\n')[0] print(header_list) uri = header_list.split(' ')[1] func_name = None for items in routes: if items[0] == uri: func_name = items[1] break if func_name: res = func_name() else: res = b'404 not found' conn.send(b'HTTP/1.1 200 OK\\r\\nCache-Control: private\\r\\n\\r\\n') conn.send(res)if __name__ == '__main__': run() index.html1234567891011&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;this is index&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt; content.html12345678910111213141516171819202122232425&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;table border=\"1px\"&gt; &lt;thead&gt; &lt;tr&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;Name&lt;/th&gt; &lt;th&gt;password&lt;/th&gt; &lt;th&gt;register_time&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;tr&gt; @@content@@ &lt;/tr&gt; &lt;/tbody&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt; article.html1234567891011&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; @@content@@&lt;/body&gt;&lt;/html&gt; 通过wsgiref实现web框架step 1访问不同的url路径可以跳转到不同的网页123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566from wsgiref.simple_server import make_serverdef application(environ, start_response): # 按着httpd协议解析数据（将所有请求存到一个字典里）: environ # 按着httpd协议组装数据（生成数据 响应首行，响应头）： start_response # 当前的请求路径 path = environ.get('PATH_INFO') start_response('200 OK', [('Content-Type', 'text/html')]) # 生成数据 请求首行，请求头，请求体 if path == \"/login\": with open('login.html', 'rb') as f: global data data = f.read() if path == '/index': with open('index.html', 'rb') as f: data = f.read() return [data]# 封装sockethttped = make_server(\"127.0.0.1\", 8060, application)# 等待客户连接: conn,addr=sock.accept()httped.serve_forever()# login.html&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=\"http://127.0.0.1:8800/\" method=\"post\"&gt; 用户名 &lt;input type=\"text\" name=\"user\"&gt; 密码 &lt;input type=\"password\" name=\"pwd\"&gt; &lt;input type=\"submit\"&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;# index.html &lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1 style=\"color: red;\"&gt;宝贝 我来了&lt;/h1&gt;&lt;img src=\"http://s14.sinaimg.cn/middle/4b955cd7xcb1739815c4d&amp;690\" alt=\"\"&gt;&lt;a href=\"http://www.w3school.com.cn/\"&gt;click&lt;/a&gt;&lt;div style=\"height: 200px\"&gt;&lt;/div&gt;&lt;div&gt; &lt;h1 style=\"color: yellow; background-color: gray\"&gt;张帆喜欢的类型&lt;/h1&gt; &lt;img src=\"http://s8.sinaimg.cn/bmiddle/005DIuBKgy6KewCX5iv97&amp;690\" alt=\"\"&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 设置页面图标为京东图标12345678910111213141516171819202122from wsgiref.simple_server import make_serverdef application(environ: dict, start_response): start_response('200 ok', [('Content-Type','text/html')]) print(\"PATH\",environ.get('PATH_INFO')) path=environ.get('PATH_INFO') if path=='/favicon.ico': with open('favicon.ico','rb') as f: data=f.read() return [data] return [b'&lt;h1&gt;Hello,web!&lt;/h1&gt;']httped = make_server(\"127.0.0.1\", 8080, application)httped.serve_forever() step 2通过列表的映射来使得访问不同的url路径可以跳转到不同的网页 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182from wsgiref.simple_server import make_serverdef login(): with open('login.html', 'rb') as f: data = f.read() return datadef index(): with open('index.html', 'rb') as f: data = f.read() return datadef favi(): with open('favicon.ico', 'rb') as f: data = f.read() return datadef application(environ: dict, start_response): start_response('200 ok', [('Content-Type', 'text/html')]) print(\"PATH\", environ.get('PATH_INFO')) # 当前请求路径 global path path = environ.get('PATH_INFO') url_patterns = [ (\"/login\", login), (\"/index\", index), (\"/favicon.ico\", favi) ] func = None for item in url_patterns: print(item) if path == item[0]: func = item[1] break print(func) if func: return [func()] else: return [b'404!']httped = make_server(\"127.0.0.1\", 8080, application)httped.serve_forever()# login.html&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;login&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h4&gt;登录页面&lt;/h4&gt;&lt;form action=\"http://127.0.0.1:8080/\" method=\"post\"&gt; 用户名 &lt;input type=\"text\" name=\"user\"&gt; 密码&lt;input type=\"password\" name=\"pwd\"&gt; &lt;input type=\"submit\"&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;# index.html&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h4&gt;welcome to here&lt;/h4&gt;&lt;/body&gt;&lt;/html&gt;","categories":[],"tags":[]}]}